import{E as t,M as e,Q as s,V as i,O as a,a as r}from"./chunk-B6DJkpsW.js";class n extends r{constructor(t){super(),this.element=t,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.addEventListener("removed",()=>{this.traverse(t=>{t instanceof n&&t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)})})}copy(t,e){return r.prototype.copy.call(this,t,e),this.element=t.element.cloneNode(!0),this}}class o extends n{constructor(t,s=1){super(t),this.spriteRatio=s,this.spriteMatrixWorld=(new e).copy(this.matrixWorld)}}class l extends t{zOrder(t){const{cache:e}=this,s=[];t.traverse(t=>{const i=t;e.objects.has(i)&&s.push({object:i,data:e.objects.get(i)})});const i=s.sort((t,e)=>t.data.distanceToCameraSquared-e.data.distanceToCameraSquared),a=i.length;i.forEach((t,e)=>{const{object:s}=t;s.element.style.zIndex=""+(a-e)})}constructor(){super(),this._width=0,this._height=0,this._widthHalf=0,this._heightHalf=0,this.matrix=new e,this._spriteQuat=new s,this._objectQuat=new s,this.cache={camera:{fov:0,style:""},objects:new WeakMap},this.epsilon=t=>Math.abs(t)<1e-10?0:t,this.getDistanceToSquared=function(){const t=new i,e=new i;return function(s,i){return t.setFromMatrixPosition(s.matrixWorld),e.setFromMatrixPosition(i.matrixWorld),t.distanceToSquared(e)}}(),this.getCameraCSSMatrix=(t,e,s)=>{const{epsilon:i}=this,{elements:r}=t,n=`matrix3d(${i(r[0])},${i(-r[1])},${i(r[2])},${i(r[3])},${i(r[4])},${i(-r[5])},${i(r[6])},${i(r[7])},${i(r[8])},${i(-r[9])},${i(r[10])},${i(r[11])},${i(r[12])},${i(-r[13])},${i(r[14])},${i(r[15])})`;if(e instanceof a){const t=-(e.right+e.left)/2,a=(e.top+e.bottom)/2;return`scale(${s})translate(${i(t)}px,${i(a)}px)${n}`}return`translateZ(${s}px)${n}`},this.getObjectCSSMatrix=(t,e)=>{const{epsilon:s}=this,{elements:i}=t,a=`matrix3d(${s(i[0])},${s(i[1])},${s(i[2])},${s(i[3])},${s(-i[4])},${s(-i[5])},${s(-i[6])},${s(-i[7])},${s(i[8])},${s(i[9])},${s(i[10])},${s(i[11])},${s(i[12])},${s(i[13])},${s(i[14])},${s(i[15])})`;return this.isIE?`translate(-50%,-50%)translate(${this._widthHalf}px,${this._heightHalf}px)${e}${a}`:`translate(-50%,-50%)${a}`},this.renderObject=(t,e,s,i)=>{const{matrix:a,getObjectCSSMatrix:r,cache:l,cameraElement:h,renderObject:c,isIE:d,getDistanceToSquared:m}=this;if(t instanceof n){let n;t.onBeforeRender(this,e,s),t instanceof o?(a.copy(s.matrixWorldInverse),a.transpose(),this._spriteQuat.setFromRotationMatrix(a),this._objectQuat.setFromRotationMatrix(t.matrixWorld),this._objectQuat.slerp(this._spriteQuat,t.spriteRatio),a.makeRotationFromQuaternion(this._objectQuat),a.copyPosition(t.matrixWorld),a.scale(t.scale),a.elements[3]=0,a.elements[7]=0,a.elements[11]=0,a.elements[15]=1,t.spriteMatrixWorld.copy(a),n=r(a,i)):n=r(t.matrixWorld,i);const{element:c}=t,p=l.objects.get(t);if(void 0===p||p.style!==n){c.style.transform=n;const e={style:n};l.objects.set(t,e),d&&(e.distanceToCameraSquared=m(s,t))}c.style.display=t.visible?"":"none",c.parentNode!==h&&h.appendChild(c),t.onAfterRender(this,e,s)}for(let n=0,o=t.children.length;n<o;n++)c(t.children[n],e,s,i)};const t=document.createElement("div");this.domElement=t,t.style.overflow="hidden";const r=document.createElement("div");this.cameraElement=r,r.style.transformStyle="preserve-3d",t.appendChild(r),this.isIE=/Trident/i.test(navigator.userAgent)}setClearColor(){}getSize(){return{width:this._width,height:this._height}}setSize(t,e){this._width=t,this._height=e,this._widthHalf=this._width/2,this._heightHalf=this._height/2,this.domElement.style.width=`${t}px`,this.domElement.style.height=`${e}px`,this.cameraElement.style.width=`${t}px`,this.cameraElement.style.height=`${e}px`}render(t,e){const{_heightHalf:s,_widthHalf:i,isIE:a,cameraElement:r,cache:n,domElement:o,getCameraCSSMatrix:l,zOrder:h,renderObject:c}=this,d=e.projectionMatrix.elements[5]*s;n.camera.fov!==d&&(o.style.perspective=`${d}px`,n.camera.fov=d),(t.matrixAutoUpdate&&!0===t.matrixAutoUpdate||!0===t.autoUpdate)&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld();const m=l(e.matrixWorldInverse,e,d),p=`${m}translate(${i}px,${s}px)`;n.camera.style===p||a||(r.style.transform=p,n.camera.style=p),c(t,t,e,m),a&&h(t)}}export{l as C,n as a};
