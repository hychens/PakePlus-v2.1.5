import{u as e}from"./chunk-CMvwsE4m.js";import{_ as t}from"./chunk-D8hQqvaP.js";import{i as a,u as l,a as n,l as s,b as o}from"./chunk-B1QQEMu0.js";import{K as r,r as i,V as d,P as p,ab as u,T as c,R as m,al as b,am as f,ad as g,ai as h,u as y,ag as v,ah as k,v as w,B as x,Z as D,Q as P,F as j,i as T}from"./chunk-BG8DtHa0.js";import{_}from"./chunk-ByzPB9Ai.js";import{s as R}from"./chunk-D-SUFnWt.js";import{d as C}from"./chunk-BhpgeEpq.js";import{u as A,w as O}from"./chunk-BtghHq-e.js";import{r as z,a as L}from"./chunk-DsM932Ci.js";import{v as F}from"./chunk-CC7_aw_8.js";import"./chunk-lIqasEa_.js";import"./chunk-DHt_odDz.js";import"./chunk-B6DJkpsW.js";import"./chunk-BQCeX3nN.js";import"./chunk-CM4-pTv8.js";import"./chunk-CQVWWOr1.js";import"./chunk-FD3pif8V.js";import"./chunk-FU3iQhBg.js";import"./chunk-DfTdyrnt.js";import"./chunk-BXrkUfDV.js";import"./chunk-D-DsPvTv.js";import"./chunk-7CVvifAO.js";import"./chunk-CLSYnucs.js";import"./chunk-BenQXQHa.js";import"./chunk-Dcd9jy7q.js";import"./chunk-DezxjiP8.js";import"./chunk-Df6UfjYh.js";const N={class:"drawer drawer-end h-0 w-0"},W={class:"drawer-content w-0 h-0 absolute"},S={class:"drawer-side"},U={key:0,class:"menu bg-base-200 min-h-full w-80 p-4"},E=r({__name:"index",setup(e,{expose:t}){const a=i(null),l=i(!1);return t({showDrawer:function(){a.value?.click(),l.value=!0},closeDrawer:function(){a.value?.click(),l.value=!1}}),(e,t)=>(p(),d("div",N,[t[1]||(t[1]=u("input",{id:"my-drawer-1",type:"checkbox",class:"drawer-toggle"},null,-1)),u("div",W,[u("label",{ref_key:"drawerTriggerRef",ref:a,for:"my-drawer-1"},null,512)]),u("div",S,[t[0]||(t[0]=u("label",{for:"my-drawer-1","aria-label":"close sidebar",class:"drawer-overlay"},null,-1)),l.value?(p(),d("div",U,[m(e.$slots,"content")])):c("",!0)])]))}}),I={class:"fieldset"},V={class:"label"},$=["placeholder"],J={class:"fieldset"},M={class:"label",required:""},q=["placeholder"],Q={class:"validator-hint hidden"},B={class:"fieldset"},G={class:"label"},H=["placeholder"],K={class:"fieldset"},X={class:"label"},Y=["placeholder"],Z={class:"btn btn-neutral mt-4",type:"submit"},ee=r({__name:"SinglePerson",props:b({addOnePersonDrawerRef:{},addOnePerson:{type:Function}},{singlePersonData:{required:!0},singlePersonDataModifiers:{}}),emits:["update:singlePersonData"],setup(t){const{t:a}=e(),l=f(t,"singlePersonData");return(e,n)=>(p(),d("form",{class:"fieldset rounded-box w-xs p-4",onSubmit:n[5]||(n[5]=e=>t.addOnePerson(t.addOnePersonDrawerRef,e))},[u("label",I,[u("span",V,h(y(a)("table.number")),1),g(u("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>l.value.uid=e),type:"text",class:"input validator",placeholder:y(a)("table.number")},null,8,$),[[v,l.value.uid]])]),u("fieldset",J,[u("label",M,[k(h(y(a)("table.name")),1),n[6]||(n[6]=u("span",{class:"text-red-500"},"*",-1))]),g(u("input",{"onUpdate:modelValue":n[1]||(n[1]=e=>l.value.name=e),type:"text",class:"input validator",placeholder:y(a)("table.name"),required:"",minlength:"1"},null,8,q),[[v,l.value.name]]),u("p",Q,h(y(a)("error.personNameEmpty")),1)]),u("label",B,[u("span",G,h(y(a)("table.department")),1),g(u("input",{"onUpdate:modelValue":n[2]||(n[2]=e=>l.value.department=e),type:"text",class:"input validator",placeholder:y(a)("table.department")},null,8,H),[[v,l.value.department]])]),u("label",K,[u("span",X,h(y(a)("table.identity")),1),g(u("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>l.value.identity=e),type:"text",class:"input validator",placeholder:y(a)("table.identity")},null,8,Y),[[v,l.value.identity]])]),u("button",Z,h(y(a)("button.confirm")),1),u("button",{class:"btn btn-ghost mt-1",type:"reset",onClick:n[4]||(n[4]=e=>t.addOnePersonDrawerRef.closeDrawer())},h(y(a)("button.cancel")),1)],32))}});function te(e){return new Worker(""+new URL("../assets/importExcel.worker-CWYp5aq3.js",import.meta.url).href,{name:e?.name})}function ae({exportInputFileRef:t,addExportInputFileRef:o}){const{t:r}=e(),d="./".replace("./","/"),p=C.useToast(),u=new te,c=x(s),m=l().personConfig,{getAllPersonList:b,getAlreadyPersonList:f}=R(m),g=(h={handleDeletePerson:function(e){m.deletePerson(e)}},[{label:a.global.t("data.number"),props:"uid"},{label:a.global.t("data.name"),props:"name"},{label:a.global.t("data.department"),props:"department"},{label:a.global.t("data.identity"),props:"identity"},{label:a.global.t("data.isWin"),props:"isWin",formatValue:e=>e.isWin?a.global.t("data.yes"):a.global.t("data.no")},{label:a.global.t("data.operation"),actions:[{label:a.global.t("data.delete"),type:"btn-error",onClick:e=>{h.handleDeletePerson(e)}}]}]);var h;const y=i(!1),v=i({uid:"",name:"",department:"",avatar:"",identity:""});async function k(){if("zhCn"===a.global.locale.value){return await L(`${d}人口登记表-zhCn.xlsx`)}return await L(`${d}personListTemplate-en.xlsx`)}async function D(e){var t;c?.show(),k(),t={type:"start",data:e,templateData:await k()},u&&u.postMessage(t)}return{resetData:function(){m.resetAlreadyPerson()},deleteAll:function(){m.deleteAllPerson()},handleFileChange:async function(e,a){u&&(u.onmessage=e=>{if("done"===e.data.type&&(a||m.resetPerson(),m.addNotPersonList(e.data.data),p.open({message:r("error.importSuccess"),type:"success",position:"top-right"}),function(){t.value&&(t.value.value="");o&&(o.value.value="")}()),"error"===e.data.type){if("not right template"===e.data.message)return void p.open({message:r("error.excelFileError"),type:"error",position:"top-right"});p.open({message:e.data.message||r("error.importFail"),type:"error",position:"top-right"})}c?.hide()}),D(await z(e.target.files[0]))},exportData:function(){let e=JSON.parse(JSON.stringify(b.value));for(let l=0;l<e.length;l++)delete e[l].x,delete e[l].y,delete e[l].id,delete e[l].uuid,delete e[l].createTime,delete e[l].updateTime,delete e[l].prizeId,delete e[l].type,delete e[l].dateTime,e[l].isWin?e[l].isWin=a.global.t("data.yes"):e[l].isWin=a.global.t("data.no"),e[l].prizeTime=e[l].prizeTime.join(","),e[l].prizeName=e[l].prizeName.join(","),e[l].prizeDesc=e[l]?.prizeDesc?.join?.(",");let t=JSON.stringify(e);if(t=t.replaceAll(/uid/g,a.global.t("data.number")).replaceAll(/isWin/g,a.global.t("data.isWin")).replaceAll(/department/g,a.global.t("data.department")).replaceAll(/name/g,a.global.t("data.name")).replaceAll(/identity/g,a.global.t("data.identity")).replaceAll(/prizeName/g,a.global.t("data.prizeName")).replaceAll(/prizeTime/g,a.global.t("data.prizeTime")).replaceAll(/prizeDesc/g,"奖品名称"),e=JSON.parse(t),e.length>0){const t=A.json_to_sheet(e),a=A.book_new();A.book_append_sheet(a,t,"Sheet1"),O(a,"data.xlsx")}},alreadyPersonList:f,allPersonList:b,tableColumnList:g,addOnePerson:function(e,t){t.preventDefault();const a=n([w(v.value)]);a[0].id=F(),m.addOnePerson(a),e.closeDrawer(),v.value={}},addPersonModalVisible:y,singlePersonData:v,downloadTemplate:function(){const e=a.global.t("data.xlsxName");fetch(`${d}${e}`).then(e=>e.blob()).then(t=>{const a=window.URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=e,l.click(),p.open({message:r("error.downloadSuccess"),type:"success",position:"top-right"})})}}}const le={class:"min-w-1000px"},ne={class:"flex gap-3"},se=["data-tip"],oe={class:""},re={for:"explore"},ie=["data-tip"],de={class:"btn btn-primary btn-sm"},pe={class:""},ue={for:"add-explore"},ce={class:"tooltip tooltip-bottom","data-tip":"导入新增人员"},me=".xlsx,.xls",be=r({__name:"index",setup(a){const l=i(),n=i(),s=i(),r=i(),c=i(),{resetData:m,deleteAll:b,handleFileChange:f,exportData:g,addOnePerson:v,singlePersonData:k,alreadyPersonList:w,allPersonList:x,tableColumnList:R,downloadTemplate:C}=ae({exportInputFileRef:s,addExportInputFileRef:r}),{t:A}=e();return(e,a)=>(p(),d(j,null,[D(o,{ref_key:"resetDataDialogRef",ref:l,title:y(A)("dialog.titleTip"),desc:y(A)("dialog.dialogResetWinner"),"submit-func":y(m)},null,8,["title","desc","submit-func"]),D(o,{ref_key:"delAllDataDialogRef",ref:n,title:y(A)("dialog.titleTip"),desc:y(A)("dialog.dialogDelAllPerson"),"submit-func":y(b)},null,8,["title","desc","submit-func"]),D(E,{ref_key:"addOnePersonDrawerRef",ref:c},{content:P(()=>[D(ee,{"single-person-data":y(k),"onUpdate:singlePersonData":a[0]||(a[0]=e=>T(k)?k.value=e:null),"add-one-person-drawer-ref":c.value,"add-one-person":y(v)},null,8,["single-person-data","add-one-person-drawer-ref","add-one-person"])]),_:1},512),u("div",le,[D(_,{title:y(A)("viewTitle.personManagement")},{buttons:P(()=>[u("div",ne,[u("button",{class:"btn btn-error btn-sm",onClick:a[1]||(a[1]=e=>n.value.showDialog())},h(y(A)("button.allDelete")),1),u("div",{class:"tooltip tooltip-bottom","data-tip":y(A)("tooltip.downloadTemplateTip")},[u("button",{class:"no-underline btn btn-secondary btn-sm",onClick:a[2]||(a[2]=(...e)=>y(C)&&y(C)(...e))},h(y(A)("button.downloadTemplate")),1)],8,se),u("div",oe,[u("label",re,[u("div",{class:"tooltip tooltip-bottom","data-tip":`${y(A)("tooltip.uploadExcelTip")}，全量覆盖，清空中奖人`},[u("input",{id:"explore",ref_key:"exportInputFileRef",ref:s,type:"file",class:"",style:{display:"none"},accept:me,onChange:a[3]||(a[3]=(...e)=>y(f)&&y(f)(...e))},null,544),u("span",de,h(y(A)("button.importData")),1)],8,ie)])]),u("button",{class:"btn btn-error btn-sm",onClick:a[4]||(a[4]=e=>l.value.showDialog())},h(y(A)("button.resetData")),1),u("button",{class:"btn btn-accent btn-sm",onClick:a[5]||(a[5]=(...e)=>y(g)&&y(g)(...e))},h(y(A)("button.exportResult")),1),u("button",{class:"btn btn-neutral btn-sm",onClick:a[6]||(a[6]=e=>c.value.showDrawer())},h(y(A)("button.add")),1),u("div",pe,[u("label",ue,[u("div",ce,[u("input",{id:"add-explore",ref_key:"addExportInputFileRef",ref:r,type:"file",class:"",style:{display:"none"},accept:me,onChange:a[7]||(a[7]=e=>y(f)(e,!0))},null,544),a[8]||(a[8]=u("span",{class:"btn btn-neutral btn-sm"},"添加导入",-1))])])]),u("div",null,[u("span",null,h(y(A)("table.luckyPeopleNumber"))+":",1),u("span",null,h(y(w).length),1),a[9]||(a[9]=u("span",null," / ",-1)),u("span",null,h(y(x).length),1)])])]),_:1},8,["title"]),D(t,{"table-columns":y(R),data:y(x)},null,8,["table-columns","data"])])],64))}});export{be as default};
