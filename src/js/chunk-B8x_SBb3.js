import{l as e}from"./chunk-DfTdyrnt.js";import{s as a}from"./chunk-D-SUFnWt.js";import{u as l}from"./chunk-CMvwsE4m.js";import{u as s,b as t,f as i}from"./chunk-B1QQEMu0.js";import{_ as n}from"./chunk-ByzPB9Ai.js";import{K as o,r as u,am as r,c as m,w as c,V as p,P as v,F as d,ab as h,Z as k,T as f,ai as b,u as g,Q as j,O as y,ad as w,ag as x,W as I}from"./chunk-BG8DtHa0.js";import{_}from"./chunk-DS7Wh8XH.js";import{v as N}from"./chunk-CC7_aw_8.js";import"./chunk-lIqasEa_.js";import"./chunk-DHt_odDz.js";import"./chunk-B6DJkpsW.js";import"./chunk-BQCeX3nN.js";import"./chunk-CM4-pTv8.js";import"./chunk-CQVWWOr1.js";import"./chunk-FD3pif8V.js";import"./chunk-FU3iQhBg.js";import"./chunk-BXrkUfDV.js";import"./chunk-D-DsPvTv.js";import"./chunk-7CVvifAO.js";import"./chunk-CLSYnucs.js";import"./chunk-BenQXQHa.js";import"./chunk-Dcd9jy7q.js";import"./chunk-BhpgeEpq.js";import"./chunk-Df6UfjYh.js";import"./chunk-DezxjiP8.js";import"./chunk-DsM932Ci.js";const S={class:"toast toast-top toast-end"},U={key:0,class:"alert alert-error"},C={key:1,class:"alert alert-success"},T={key:2,class:"alert alert-error"},D={class:"flex flex-col items-center gap-6 w-full px-12"},F=["disabled","placeholder"],M=o({__name:"UploadDialog",props:{visible:{type:Boolean,required:!0},visibleModifiers:{}},emits:["update:visible"],setup(a){const{t:i}=l(),n=u("image/*"),o=u(0),I=r(a,"visible"),M=s().globalConfig,q=e.createInstance({name:"imgStore"}),H=u(null),L=m({get:()=>H.value?.fileName||null,set(e){H.value&&e&&(H.value.fileName=e)}}),O=u();async function P(e){if(!e)return void(H.value=null);/image*/.test(e?.type||"")?H.value=e:o.value=3}function Q(){if(H.value){const{data:e,fileName:a}=H.value,l=N();q.setItem(l,{data:e,fileName:a}).then(()=>{o.value=1,async function(){(await q.keys()).length>0&&q.iterate((e,a)=>{M.addImage({id:a,name:e.fileName,url:"Storage"})})}()}).catch(()=>{o.value=2})}}return c(I,e=>{e&&O.value.showDialog()}),(e,a)=>(v(),p(d,null,[h("div",S,[2===o.value?(v(),p("div",U,[h("span",null,b(g(i)("error.uploadFail")),1)])):f("",!0),1===o.value?(v(),p("div",C,[h("span",null,b(g(i)("error.uploadSuccess")),1)])):f("",!0),3===o.value?(v(),p("div",T,[h("span",null,b(g(i)("error.notImage")),1)])):f("",!0)]),k(t,{ref_key:"uploadDialogRef",ref:O,visible:I.value,"onUpdate:visible":a[1]||(a[1]=e=>I.value=e),title:g(i)("dialog.uploadImageTitle"),"submit-func":Q,class:""},{content:j(()=>[h("div",D,[I.value?(v(),y(_,{key:0,"limit-type":n.value,onUploadFile:P},null,8,["limit-type"])):f("",!0),w(h("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>L.value=e),disabled:null===H.value,type:"text",placeholder:g(i)("placeHolder.imageName"),class:"input w-full"},null,8,F),[[x,L.value]])])]),_:1},8,["visible","title"])],64))}}),q={class:""},H={for:"explore"},L={class:"p-0"},O={class:"flex items-center gap-8"},P={class:"avatar h-14"},Q={class:"w-12 h-12 mask mask-squircle hover:w-14 hover:h-14"},V={class:"w-64"},B={class:"overflow-hidden font-bold whitespace-nowrap text-ellipsis"},G=["onClick"],J=o({__name:"index",setup(t){const{t:o}=l(),r=s().globalConfig,{getImageList:m}=a(r),f=u(0),y=e.createInstance({name:"imgStore"}),w=u(!1);return c(()=>f.value,e=>{0!==e&&setTimeout(()=>{f.value=0},2e3)}),(e,a)=>(v(),p(d,null,[k(M,{visible:w.value,"onUpdate:visible":a[0]||(a[0]=e=>w.value=e)},null,8,["visible"]),h("div",null,[k(n,{title:g(o)("sidebar.imagesManagement")},{buttons:j(()=>[h("div",q,[h("label",H,[h("span",{class:"btn btn-primary btn-sm",onClick:a[1]||(a[1]=e=>w.value=!0)},b(g(o)("button.upload")),1)])])]),_:1},8,["title"]),h("ul",L,[(v(!0),p(d,null,I(g(m),e=>(v(),p("li",{key:e.id,class:"mb-3"},[h("div",O,[h("div",P,[h("div",Q,[k(i,{"img-item":e},null,8,["img-item"])])]),h("div",V,[h("div",B,b(e.name),1)]),h("div",null,[h("button",{class:"btn btn-error btn-xs",onClick:a=>function(e){"Storage"===e.url&&y.removeItem(e.id).then(()=>{r.removeImage(e.id)}),r.removeImage(e.id)}(e)},b(g(o)("button.delete")),9,G)])])]))),128))])])],64))}});export{J as default};
