import{l as e}from"./chunk-DfTdyrnt.js";import{s as t}from"./chunk-D-SUFnWt.js";import{u as s}from"./chunk-CMvwsE4m.js";import{_ as a}from"./chunk-ByzPB9Ai.js";import{u as i,b as l}from"./chunk-B1QQEMu0.js";import{K as n,r as o,am as u,c as r,w as c,O as p,P as m,Q as b,u as d,ab as v,T as f,ad as k,ag as h,V as j,Z as g,F as y,W as x,ai as w}from"./chunk-BG8DtHa0.js";import{d as C}from"./chunk-BhpgeEpq.js";import{_ as M}from"./chunk-DS7Wh8XH.js";import{v as _}from"./chunk-CC7_aw_8.js";import"./chunk-lIqasEa_.js";import"./chunk-DHt_odDz.js";import"./chunk-B6DJkpsW.js";import"./chunk-BQCeX3nN.js";import"./chunk-CM4-pTv8.js";import"./chunk-CQVWWOr1.js";import"./chunk-FD3pif8V.js";import"./chunk-FU3iQhBg.js";import"./chunk-BXrkUfDV.js";import"./chunk-D-DsPvTv.js";import"./chunk-7CVvifAO.js";import"./chunk-CLSYnucs.js";import"./chunk-BenQXQHa.js";import"./chunk-Dcd9jy7q.js";import"./chunk-DezxjiP8.js";import"./chunk-Df6UfjYh.js";import"./chunk-DsM932Ci.js";const U={class:"flex flex-col items-center gap-6 w-full px-12"},N=["disabled"],S=n({__name:"UploadDialog",props:{visible:{type:Boolean,required:!0},visibleModifiers:{}},emits:["update:visible"],setup(t){const{t:a}=s(),n=C.useToast(),j=o("audio/*"),g=u(t,"visible"),y=i().globalConfig,x=e.createInstance({name:"audioStore"}),w=o(null),S=r({get:()=>w.value?.fileName||null,set(e){w.value&&e&&(w.value.fileName=e)}}),D=o();async function F(e){if(!e)return void(w.value=null);/audio*/.test(e?.type||"")?w.value=e:n.open({message:a("error.notAudioFile"),type:"error",position:"top-right"})}function I(){if(w.value){const{data:e,fileName:t}=w.value,s=_();x.setItem(s,{data:e,fileName:t}).then(()=>{n.open({message:a("error.uploadSuccess"),type:"success",position:"top-right"}),async function(){(await x.keys()).length>0&&x.iterate((e,t)=>{y.addMusic({id:t,name:e.fileName,url:"Storage"})})}()}).catch(()=>{n.open({message:a("error.uploadFail"),type:"error",position:"top-right"})})}}return c(g,e=>{e&&D.value.showDialog()}),(e,t)=>(m(),p(l,{ref_key:"uploadDialogRef",ref:D,visible:g.value,"onUpdate:visible":t[1]||(t[1]=e=>g.value=e),title:d(a)("dialog.uploadAudioTitle"),"submit-func":I,class:""},{content:b(()=>[v("div",U,[g.value?(m(),p(M,{key:0,"limit-type":j.value,onUploadFile:F},null,8,["limit-type"])):f("",!0),k(v("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>S.value=e),disabled:null===w.value,type:"text",class:"input w-full"},null,8,N),[[h,S.value]])])]),_:1},8,["visible","title"]))}}),D={class:"flex gap-3"},F={for:"explore"},I={class:"p-0"},L=["title"],T={class:"link hover:text-primary"},A={class:"flex gap-3"},O=["onClick"],P=["onClick"],Q=n({__name:"index",setup(l){const{t:n}=s(),u=e.createInstance({name:"audioStore"}),r=i().globalConfig,{getMusicList:c}=t(r),p=o(c),f=o(!1);function k(){r.resetMusicList(),u.clear()}function h(){r.clearMusicList(),u.clear()}return(e,t)=>(m(),j(y,null,[g(S,{visible:f.value,"onUpdate:visible":t[0]||(t[0]=e=>f.value=e)},null,8,["visible"]),v("div",null,[g(a,{title:d(n)("sidebar.musicManagement")},{buttons:b(()=>[v("div",D,[v("button",{class:"btn btn-primary btn-sm",onClick:k},w(d(n)("button.reset")),1),v("label",F,[v("span",{class:"btn btn-primary btn-sm",onClick:t[1]||(t[1]=e=>f.value=!0)},w(d(n)("button.upload")),1)]),v("button",{class:"btn btn-error btn-sm",onClick:h},w(d(n)("button.allDelete")),1)])]),_:1},8,["title"]),v("div",null,[v("ul",I,[(m(!0),j(y,null,x(p.value,e=>(m(),j("li",{key:e.id,class:"flex items-center gap-6 pb-2 mb-3"},[v("div",{class:"mr-12 overflow-hidden w-72 whitespace-nowrap text-ellipsis",title:e.name},[v("a",T,w(e.name),1)],8,L),v("div",A,[v("button",{class:"btn btn-primary btn-xs",onClick:t=>async function(e){r.setCurrentMusic(e,!1)}(e)},w(d(n)("button.play")),9,O),v("button",{class:"btn btn-error btn-xs",onClick:t=>function(e){r.removeMusic(e.id),u.removeItem(e.name)}(e)},w(d(n)("button.delete")),9,P)])]))),128))])])])],64))}});export{Q as default};
